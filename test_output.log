

==================================================
TEST QUERY: What are the reported labor market conditions in New York?
GROUP ID: default_tenant
==================================================

--- Planning: What are the reported labor market conditions in New York? ---

--- Node: planner ---
--- Executing Step: Identify Dimensions: Entity - 'New York'; Topic - 'labor market conditions'. ---
üîß Tool Call: resolve_dimension('New York', category='ENTITY')
üîß Tool Call: resolve_dimension('labor market conditions', category='TOPIC')
‚ùå Resolution failed: {neo4j_code: Neo.ClientError.Procedure.ProcedureCallFailed} {message: Failed to invoke procedure `db.index.vector.queryNodes`: Caused by: java.lang.IllegalArgumentException: There is no such vector schema index: topic_index} {gql_status: 52N37} {gql_status_description: error: procedure exception - procedure execution error. Execution of the procedure db.index.vector.queryNodes() failed.}
‚ùå Resolution failed: {neo4j_code: Neo.ClientError.Procedure.ProcedureCallFailed} {message: Failed to invoke procedure `db.index.vector.queryNodes`: Caused by: java.lang.IllegalArgumentException: There is no such vector schema index: entity_index} {gql_status: 52N37} {gql_status_description: error: procedure exception - procedure execution error. Execution of the procedure db.index.vector.queryNodes() failed.}

--- Node: executor ---
--- Replanning ---

--- Node: replanner ---
--- Executing Step: Try resolving the topic dimension using a broader synonym such as 'Employment' instead of 'Labor market conditions'. ---
üîß Tool Call: resolve_dimension('New York', category='ENTITY')
üîß Tool Call: resolve_dimension('Employment', category='TOPIC')
‚ùå Resolution failed: {neo4j_code: Neo.ClientError.Procedure.ProcedureCallFailed} {message: Failed to invoke procedure `db.index.vector.queryNodes`: Caused by: java.lang.IllegalArgumentException: There is no such vector schema index: entity_index} {gql_status: 52N37} {gql_status_description: error: procedure exception - procedure execution error. Execution of the procedure db.index.vector.queryNodes() failed.}
‚ùå Resolution failed: {neo4j_code: Neo.ClientError.Procedure.ProcedureCallFailed} {message: Failed to invoke procedure `db.index.vector.queryNodes`: Caused by: java.lang.IllegalArgumentException: There is no such vector schema index: topic_index} {gql_status: 52N37} {gql_status_description: error: procedure exception - procedure execution error. Execution of the procedure db.index.vector.queryNodes() failed.}

--- Node: executor ---
--- Replanning ---

--- Node: replanner ---
--- Executing Step: Try resolving the entity dimension with more specific identifiers, such as 'New York State' or 'New York City', to improve resolution accuracy. ---
üîß Tool Call: resolve_dimension('New York State', category='ENTITY')
üîß Tool Call: resolve_dimension('New York City', category='ENTITY')
‚ùå Resolution failed: {neo4j_code: Neo.ClientError.Procedure.ProcedureCallFailed} {message: Failed to invoke procedure `db.index.vector.queryNodes`: Caused by: java.lang.IllegalArgumentException: There is no such vector schema index: entity_index} {gql_status: 52N37} {gql_status_description: error: procedure exception - procedure execution error. Execution of the procedure db.index.vector.queryNodes() failed.}
‚ùå Resolution failed: {neo4j_code: Neo.ClientError.Procedure.ProcedureCallFailed} {message: Failed to invoke procedure `db.index.vector.queryNodes`: Caused by: java.lang.IllegalArgumentException: There is no such vector schema index: entity_index} {gql_status: 52N37} {gql_status_description: error: procedure exception - procedure execution error. Execution of the procedure db.index.vector.queryNodes() failed.}

--- Node: executor ---
--- Replanning ---

--- Node: replanner ---
--- Executing Step: Try resolving the entity dimension using alternative identifiers such as 'NYC' or 'New York Metropolitan Area'. ---
üîß Tool Call: resolve_dimension('NYC', category='ENTITY')
üîß Tool Call: resolve_dimension('New York Metropolitan Area', category='ENTITY')
‚ùå Resolution failed: {neo4j_code: Neo.ClientError.Procedure.ProcedureCallFailed} {message: Failed to invoke procedure `db.index.vector.queryNodes`: Caused by: java.lang.IllegalArgumentException: There is no such vector schema index: entity_index} {gql_status: 52N37} {gql_status_description: error: procedure exception - procedure execution error. Execution of the procedure db.index.vector.queryNodes() failed.}
‚ùå Resolution failed: {neo4j_code: Neo.ClientError.Procedure.ProcedureCallFailed} {message: Failed to invoke procedure `db.index.vector.queryNodes`: Caused by: java.lang.IllegalArgumentException: There is no such vector schema index: entity_index} {gql_status: 52N37} {gql_status_description: error: procedure exception - procedure execution error. Execution of the procedure db.index.vector.queryNodes() failed.}

--- Node: executor ---
--- Replanning ---

--- Node: replanner ---
--- Executing Step: Try resolving the topic dimension using a broader term such as 'Job Market' or 'Workforce' instead of 'Labor market conditions' or 'Employment'. ---
üîß Tool Call: resolve_dimension('Job Market', category='TOPIC')
üîß Tool Call: resolve_dimension('Workforce', category='TOPIC')
‚ùå Resolution failed: {neo4j_code: Neo.ClientError.Procedure.ProcedureCallFailed} {message: Failed to invoke procedure `db.index.vector.queryNodes`: Caused by: java.lang.IllegalArgumentException: There is no such vector schema index: topic_index} {gql_status: 52N37} {gql_status_description: error: procedure exception - procedure execution error. Execution of the procedure db.index.vector.queryNodes() failed.}
‚ùå Resolution failed: {neo4j_code: Neo.ClientError.Procedure.ProcedureCallFailed} {message: Failed to invoke procedure `db.index.vector.queryNodes`: Caused by: java.lang.IllegalArgumentException: There is no such vector schema index: topic_index} {gql_status: 52N37} {gql_status_description: error: procedure exception - procedure execution error. Execution of the procedure db.index.vector.queryNodes() failed.}

--- Node: executor ---
--- Replanning ---
Traceback (most recent call last):
  File "/home/rithv/Programming/Startups/ZommaLabsKG/src/scripts/test_query_agent_v2.py", line 46, in <module>
    run_test(q)
  File "/home/rithv/Programming/Startups/ZommaLabsKG/src/scripts/test_query_agent_v2.py", line 22, in run_test
    for event in graph.stream(inputs):
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/langgraph/pregel/main.py", line 2643, in stream
    for _ in runner.tick(
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/langgraph/pregel/_runner.py", line 167, in tick
    run_with_retry(
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/langgraph/pregel/_retry.py", line 42, in run_with_retry
    return task.proc.invoke(task.input, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 656, in invoke
    input = context.run(step.invoke, input, config, **kwargs)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/langgraph/_internal/_runnable.py", line 400, in invoke
    ret = self.func(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/src/workflows/query_workflow_v2.py", line 148, in replanner_node
    result = replanner.invoke({
             ^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 3129, in invoke
    input_ = context.run(step.invoke, input_, config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5534, in invoke
    return self.bound.invoke(
           ^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 398, in invoke
    self.generate_prompt(
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1117, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 927, in generate
    self._generate_with_cache(
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py", line 1221, in _generate_with_cache
    result = self._generate(
             ^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/langchain_openai/chat_models/base.py", line 1324, in _generate
    self.root_client.chat.completions.with_raw_response.parse(
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/openai/_legacy_response.py", line 364, in wrapped
    return cast(LegacyAPIResponse[R], func(*args, **kwargs))
                                      ^^^^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/openai/resources/chat/completions/completions.py", line 184, in parse
    return self._post(
           ^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 1259, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/openai/_base_client.py", line 982, in request
    response = self._client.send(
               ^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/httpx/_client.py", line 914, in send
    response = self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/httpx/_client.py", line 942, in _send_handling_auth
    response = self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/httpx/_client.py", line 979, in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/httpx/_client.py", line 1014, in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/httpx/_transports/default.py", line 250, in handle_request
    resp = self._pool.handle_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/httpcore/_sync/connection_pool.py", line 256, in handle_request
    raise exc from None
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/httpcore/_sync/connection_pool.py", line 236, in handle_request
    response = connection.handle_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/httpcore/_sync/connection.py", line 103, in handle_request
    return self._connection.handle_request(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/httpcore/_sync/http11.py", line 136, in handle_request
    raise exc
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/httpcore/_sync/http11.py", line 106, in handle_request
    ) = self._receive_response_headers(**kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/httpcore/_sync/http11.py", line 177, in _receive_response_headers
    event = self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/httpcore/_sync/http11.py", line 217, in _receive_event
    data = self._network_stream.read(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/rithv/Programming/Startups/ZommaLabsKG/.venv/lib/python3.11/site-packages/httpcore/_backends/sync.py", line 128, in read
    return self._sock.recv(max_bytes)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/rithv/.local/share/uv/python/cpython-3.11.14-linux-x86_64-gnu/lib/python3.11/ssl.py", line 1295, in recv
    return self.read(buflen)
           ^^^^^^^^^^^^^^^^^
  File "/home/rithv/.local/share/uv/python/cpython-3.11.14-linux-x86_64-gnu/lib/python3.11/ssl.py", line 1168, in read
    return self._sslobj.read(len)
           ^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt
